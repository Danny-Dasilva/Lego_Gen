const { BrowserWindow, app } = require("electron");
const pie = require("puppeteer-in-electron");
const puppeteer = require("puppeteer-core");
const fs = require("fs");

const colors = {
  Black: "#materials-overview > div:nth-child(1) > div:nth-child(4)",
};
let partList_1000 = [
  "3023",
  "6141",
  "3004",
  "3024",
  "2780",
  "3005",
  "3003",
  "3710",
  "3010",
  "3020",
  "3069b",
  "54200",
  "3001",
  "3022",
  "98138",
  "3021",
  "2412b",
  "3666",
  "3062b",
  "6558",
  "3070b",
  "3623",
  "3622",
  "3009",
  "2431",
  "3040b",
  "3068b",
  "4274",
  "3795",
  "3437",
  "2420",
  "43093",
  "3002",
  "32062",
  "3713",
  "3039",
  "4070",
  "3460",
  "3660",
  "6636",
  "15573",
  "4032a",
  "3665",
  "85984",
  "3700",
  "3034",
  "3941",
  "2357",
  "4519",
  "11477",
  "59900",
  "3008",
  "87079",
  "25269",
  "32123b",
  "3673",
  "4162",
  "87580",
  "2877",
  "87087",
  "32054",
  "15068",
  "30136",
  "32028",
  "6091",
  "4477",
  "3001a",
  "3749",
  "3794a",
  "3705",
  "2654",
  "6536",
  "85861",
  "63864",
  "3011",
  "4286",
  "44728",
  "3003a",
  "2540",
  "3031",
  "59443",
  "3065",
  "6541",
  "2456",
  "3032",
  "15712",
  "99780",
  "3701",
  "3037",
  "60478",
  "3832",
  "99207",
  "50950",
  "32013",
  "48336",
  "3298",
  "33291",
  "24866",
  "4740",
  "3794b",
  "98283",
  "60897",
  "32140",
  "4589",
  "32073",
  "32316",
  "4081b",
  "63868",
  "32523",
  "30374",
  "32000",
  "3706",
  "11211",
  "6632",
  "30414",
  "3937",
  "3035",
  "53451",
  "61409",
  "32524",
  "41677",
  "4865a",
  "3007",
  "2432",
  "298c02",
  "32002",
  "2555",
  "42003",
  "32526",
  "73983",
  "62462",
  "99206",
  "3742",
  "32064a",
  "32039",
  "92280",
  "22885",
  "4085c",
  "93273",
  "3711a",
  "60483",
  "61252",
  "2445",
  "6587",
  "3894",
  "99781",
  "3245c",
  "15672",
  "32278",
  "92593",
  "32034",
  "4624",
  "3709",
  "18654",
  "40490",
  "3702",
  "6019",
  "32184",
  "2450",
  "3297",
  "3747b",
  "32123a",
  "48729b",
  "20482",
  "11214",
  "32525",
  "35480",
  "49668",
  "6014b",
  "3659",
  "61332",
  "11153",
  "3703",
  "44302a",
  "3002a",
  "32064b",
  "3873",
  "3707",
  "3641",
  "6231",
  "41769",
  "41770",
  "3036",
  "4865b",
  "4282",
  "43722",
  "60481",
  "14769",
  "99563",
  "60479",
  "4460b",
  "6538b",
  "60592",
  "43723",
  "32556",
  "3958",
  "3680",
  "3957a",
  "6134",
  "87994",
  "60470b",
  "87083",
  "3633",
  "60601",
  "32952",
  "2458",
  "88323",
  "87552",
  "33909",
  "60474",
  "63965",
  "3030",
  "3829c01",
  "2454a",
  "64567",
  "4599b",
  "6111",
  "3938",
  "64644",
  "2449",
  "6628",
  "3895",
  "3176",
  "30153",
  "3045",
  "11458",
  "85080",
  "44294",
  "47457",
  "32449",
  "30377",
  "30565",
  "15379",
  "24201",
  "3679",
  "51739",
  "6589",
  "11090",
  "4287b",
  "11476",
  "30357",
  "18674",
  "41239",
  "4185",
  "3063b",
  "4265a",
  "32270",
  "2921",
  "6232",
  "60475b",
  "3029",
  "18651",
  "3647",
  "40666",
  "32016",
  "3033",
  "2419",
  "3737",
  "27925",
  "88072",
  "2444",
  "6015",
  "24246",
  "2454b",
  "3006",
  "2436",
  "26601",
  "4600",
  "3062a",
  "32009",
  "3708",
  "32607",
  "3483",
  "15100",
  "30503",
  "4216",
  "98313",
  "3678b",
  "26603",
  "6112",
  "6553",
  "30137",
  "55981",
  "18677",
  "26047",
  "87747",
  "2817",
  "3038",
  "12825",
  "2825",
  "3139",
  "10247",
  "32056",
  "42924",
  "2465",
  "61184",
  "6005",
  "15535",
  "2302",
  "11212",
  "28192",
  "6215",
  "4733",
  "2730",
  "92947",
  "32291",
  "32174",
  "60596",
  "15207",
  "14719",
  "3738",
  "2460",
  "4510",
  "4079",
  "54383",
  "14704",
  "4599a",
  "54384",
  "87620",
  "4488",
  "6179",
  "87697",
  "3028",
  "60477",
  "2423",
  "47905",
  "4265b",
  "49307",
  "3741",
  "42022",
  "32018",
  "3839b",
  "30363",
  "32530",
  "3185",
  "6629",
  "3831",
  "3830",
  "3651",
  "32014",
  "48092",
  "4175",
  "22388",
  "3957b",
  "59426",
  "32192",
  "41678",
  "58176",
  "3048c",
  "30028",
  "15392",
  "30383",
  "34103",
  "32015",
  "4871",
  "64647",
  "3899",
  "2476a",
  "87544",
  "4150",
  "52107",
  "36840",
  "42610",
  "30236",
  "4287a",
  "15070",
  "60484",
  "93274",
  "4490",
  "3684",
  "6157",
  "32001",
  "4079b",
  "26604",
  "4697b",
  "41669",
  "2453b",
  "88646",
  "3747a",
  "2653",
  "2453a",
  "93606",
  "10201",
  "11203",
  "41740",
  "42023",
  "32348",
  "32828",
  "3942c",
  "32271",
  "14716",
  "32803",
  "50745",
  "43857",
  "3743",
  "33183",
  "44301a",
  "27263",
  "2343",
  "59349",
  "30602",
  "3482",
  "44567a",
  "47455",
  "2736",
  "48989",
  "63869",
  "30553",
  "60581",
  "14417",
  "6223",
  "88930",
  "4623",
  "60593",
  "24316",
  "61678",
  "6180",
  "3854",
  "56145",
  "32017",
  "3245b",
  "22385",
  "4460a",
  "41539",
  "4864b",
  "4349",
  "30367c",
  "43898",
  "2417",
  "50951",
  "98560",
  "3068a",
  "4459",
  "6510",
  "1121L",
  "1131L",
  "32124",
  "1132L",
  "1142L",
  "1141L",
  "1031B",
  "1111L",
  "1041B",
  "1021B",
  "1122L",
  "1011A",
  "92950",
  "30237a",
  "87082",
  "29120",
  "4019",
  "6014a",
  "15470",
  "29119",
  "2569",
  "43337",
  "75535",
  "88292",
  "30162",
  "30000",
  "2462",
  "24309",
  "43888",
  "30237b",
  "4066",
  "44676",
  "30176",
  "55013",
  "11215",
  "60471",
  "3960",
  "14418",
  "60602",
  "96874",
  "11478",
  "3027",
  "15462",
  "2905",
  "4495b",
  "30145",
  "6126a",
  "60594",
  "13547",
  "13965",
  "4276b",
  "6081",
  "32063",
  "22961",
  "36841",
  "15571",
  "3856",
  "44301b",
  "21459",
  "6126b",
  "23443",
  "3956",
  "3046a",
  "30365",
  "30552",
  "37352",
  "6106",
  "98138pr0008",
  "3823",
  "32138",
  "4275b",
  "2496",
  "18653",
  "4862",
  "2447",
  "32250",
  "76371",
  "91988",
  "23969",
  "3040a",
  "40379",
  "60849",
  "57518",
  "3299",
  "3853",
  "4495a",
  "32474",
  "3023a",
  "47398",
  "4727",
  "6003",
  "6182",
  "2339",
  "30157",
  "47397",
  "7039",
  "15208",
  "4083",
  "30165",
  "30367b",
  "3081cc01",
  "60470a",
  "6249",
  "15303",
  "53989",
  "3307",
  "4735",
  "92438",
  "14395",
  "24307",
  "4315",
  "27507",
  "59895",
  "57895",
  "3069a",
  "3455",
  "18649",
  "30044",
  "60485",
  "4445",
  "42446",
  "m3001",
  "55982",
  "44861",
  "30350b",
  "2723",
  "50304",
  "47456",
  "24299",
  "94925",
  "3626c",
  "15706",
  "4728",
  "30526",
  "73092",
  "50305",
  "970c00",
  "87414",
  "92946",
  "13731",
  "14696",
  "6266",
  "3062c",
  "18671",
  "132a",
  "11055",
  "4143",
  "18980",
  "30391",
  "4590",
  "4215b",
  "30031",
  "52501",
  "3676",
  "6248",
  "upn0389",
  "2852",
  "2851",
  "4218",
  "32072",
  "3137c01",
  "4497",
  "20310",
  "1531",
  "60476",
  "35787",
  "3581",
  "1521",
  "87081",
  "1561A",
  "1561B",
  "1511",
  "3648b",
  "11253",
  "7049b",
  "43719",
  "4859",
  "92013",
  "64782",
  "6222",
  "4345b",
  "3704",
  "3300",
  "25214",
  "22667",
  "10928",
  "92582",
  "3788",
  "30027b",
  "98100",
  "41682",
  "3005pr9996",
  "4346",
  "15403",
  "11609",
  "4006",
  "2335",
  "33299a",
  "60608",
  "13548",
  "87609",
  "2853",
  "3464",
  "41532",
  "30055",
  "30285",
  "10197",
  "64179",
  "3308",
  "28802",
  "32557",
  "3005pr0003",
  "11833",
  "32059",
  "58247",
  "90194",
  "41748",
  "30562",
  "2530",
  "32065",
  "4213",
  "6565",
  "22888",
  "61485",
  "3069bpr0100",
  "6564",
  "30099",
  "45677",
  "2926",
  "3822",
  "4084",
  "33243",
  "41747",
  "46212",
  "93095",
  "30386",
  "4595",
  "30364",
  "11213",
  "3041",
  "6020",
  "3821",
  "92690",
  "32531",
  "3849",
  "3962b",
  "4085b",
  "4716",
  "44568",
  "37762",
  "85543",
  "3837",
  "53585",
  "6474",
  "71509",
  "98282",
  "60475a",
  "4095",
  "3675",
  "61482",
  "4273b",
  "4533",
  "15332",
  "2639",
  "93571",
  "52031",
  "57878",
  "4176",
  "2489",
  "42195",
  "15458",
  "47458",
  "2301",
  "4449",
  "60208",
  "3648a",
  "6378",
  "4476b",
  "30385",
  "43710",
  "2655",
  "45590",
  "75937",
  "48729a",
  "3959",
  "122c01",
  "30355",
  "2815",
  "11610",
  "34337",
  "32532",
  "2340",
  "30356",
  "4625",
  "6191",
  "92907",
  "36752a",
  "3685",
  "18575",
  "64799",
  "31110",
  "32606",
  "15533",
  "44126",
  "50944pr0001",
  "15400",
  "43711",
  "6259",
  "4531",
  "2479",
  "3043",
  "14419",
  "3456",
  "3649",
  "11127",
  "99021",
  "74967",
  "15254",
  "4854",
  "92402",
  "2346",
  "33320",
  "13971",
  "6583",
  "6575",
  "4588",
  "99773",
  "15395",
  "4864a",
  "48169",
  "16770",
  "32269",
  "2850a",
  "3900",
  "6140",
  "273",
  "35464",
  "2486",
  "2744",
  "6060",
  "99008",
  "89522",
  "2361Mx",
  "2351Mx",
  "2341Mx",
  "2315",
  "2314",
  "2371",
  "33078",
  "32249",
  "64727",
  "62361",
  "58090",
  "2214",
  "4287c",
  "30046",
  "92410",
  "65487",
  "41854",
  "30648",
  "6041",
  "17485",
  "60700",
  "43713",
  "61254",
  "6187",
  "10314",
  "11618",
  "30586",
  "61780",
  "48171",
  "91405",
  "93609",
  "2413",
  "11946",
  "60169",
  "4033",
  "32126",
  "90617",
  "90609",
  "11947",
  "85943",
  "92338",
  "3475b",
  "50254",
  "upn0373",
  "3613",
  "3582",
  "30663",
  "41531",
  "98138pr0060",
  "2566",
  "22890",
  "78c02",
  "upn0372",
  "55236",
  "15461",
  "3229a",
  "3230a",
  "90258",
  "93160",
  "56902",
  "3612",
  "2854",
  "2300",
  "54821",
  "30504",
  "18646",
  "43712",
  "90195",
  "60219",
  "60032",
  "11208",
  "47753",
  "4199",
  "60176",
  "64570",
  "74747",
  "24855",
  "2377",
  "30132",
  "4739a",
  "95344",
  "m3003",
  "50943",
  "90641",
  "27940",
  "4855",
  "4738a",
  "30150",
  "2577",
  "90640",
  "92099",
  "15391",
  "2362a",
  "4522",
  "3184",
  "88293",
  "23950",
  "3943b",
  "98585",
  "18853",
  "15456",
  "4161",
  "4132",
  "16577",
  "298c03",
  "53400",
  "upn0374",
  "85544",
  "4515",
  "3626b",
  "44570",
  "4022",
  "14718",
  "6190",
  "41767",
  "3857",
  "98139",
  "3940b",
  "2437",
  "30554b",
  "2412a",
  "3634",
  "44809",
  "98223",
  "50923",
  "4536",
  "4672",
  "88393",
  "78c09",
  "60583b",
  "57909b",
  "64648",
  "30395",
  "60212",
  "41768",
  "44524",
  "6183",
  "znapupn0002",
  "61903",
  "76766",
  "61072",
  "48170",
  "32187",
  "32529",
  "62113",
  "61345",
  "60607",
  "87618",
  "11209",
  "3650c",
  "27261",
  "44375b",
  "4528",
  "74261",
  "3049d",
  "4133",
  "4532",
  "33299b",
  "3070bpr0007",
  "4870",
  "37775",
  "2878c01",
  "55615",
  "64225",
  "65304",
  "60623",
  "32209",
  "30340",
  "41862",
  "50861",
  "7b",
  "3836",
  "15209",
  "85941",
  "6239",
  "32555",
  "92738",
  "32324",
  "50862",
  "32005a",
  "60603",
  "63082",
  "57585",
  "30359b",
  "32200",
  "6233",
  "72454",
  "3861b",
  "458",
  "4034",
  "3044c",
  "3009a",
  "24375",
  "59230",
  "4166",
  "33085",
  "3437pr0067",
  "3835",
  "6254",
  "18976",
  "33051",
  "14720",
  "2452",
  "3081bc01",
  "92851",
  "9244",
  "44300",
  "30173b",
  "25893",
  "3228a",
  "6256",
  "10884",
  "98721",
  "33303",
  "6192",
  "85975",
  "98834",
  "3963",
  "4863",
  "33172",
  "33286",
  "4285b",
  "92220",
  "30043",
];

const url = "https://www.mecabricks.com/en/login";
const workshop = "https://www.mecabricks.com/en/workshop";
const part = "3004";

let names = [];

const main = async () => {
  await pie.initialize(app);
  const browser = await pie.connect(app, puppeteer);

  const window = new BrowserWindow({ width: 1200, height: 800 });
  await window.loadURL(url);

  const page = await pie.getPage(browser, window);

  //login

  //   await page.type('#field-identifier', '')
  //   await page.type('#field-password', '')
  //   await page.click('#remember-me')
  //   await page.click('#button')
  await page.goto(workshop);

  await page.waitForSelector("div.ui-panel-wrapper:nth-child(4)", {
    visible: true,
  });
  await page.waitForTimeout(1000);
  await page.click("div.ui-panel-wrapper:nth-child(4)");
  await page.waitForSelector(
    ".filter-panel > div:nth-child(1) > div:nth-child(1) > label:nth-child(2) > svg:nth-child(1)",
    {
      visible: true,
    }
  );
  await page.click(
    ".filter-panel > div:nth-child(1) > div:nth-child(1) > label:nth-child(2) > svg:nth-child(1)"
  );
  await page.click(
    ".filter-panel > div:nth-child(3) > div:nth-child(1) > label:nth-child(2) > svg:nth-child(1)"
  );
  //search in loop

  console.log("here");
  await page.waitForTimeout(1000);

  for (var i = 0; i < partList.length; i++) {
    let partname = partList[i];
    await page.type(".ui-search-wrapper > input:nth-child(2)", partList[i]);
    await page.click(".search-button");

    await page.waitForTimeout(1000);

    //for loop for colors here
    for (const [color_name, color] of Object.entries(colors)) {
      await page.waitForTimeout(1000);
      // click on part

      await page.evaluate((partname) => {
        let elements = document.getElementsByClassName("reference");
        console.log(partname, "working");
        for (let element of elements) {
          let name = element.innerHTML;
          if (name === partname) {
            element.click();
          }
        }
      }, partname);
      await page.click(color);
      names.push(`${partname}-${color_name}`);
    }

    await page.click(".ui-search-wrapper > input:nth-child(2)");

    for (let i = 0; i < partList[i].length; i++) {
      await page.keyboard.press("Backspace");
    }
  }

  console.log(names);
  const fs = require("fs");
  fs.writeFile("./my-downloads/filenames.json", JSON.stringify(names), (err) =>
    err ? console.log(err) : null
  );
  // await page.click('#menu-file')
  // await page.click('#menu-export')
  // await page.select('#export-format > select:nth-child(1)', 'mbx')
  // await page.waitForTimeout(500);
  // await page._client.send('Page.setDownloadBehavior', {behavior: 'allow', downloadPath: './my-downloads'})
  // await page.click('#export-button')

  // await page.waitForTimeout(6000);

  // fs.rename('./my-downloads/Untitled\ Model.zmbx', `./my-downloads/${key}.zmbx`, () => {
  //   console.log("\nFile Renamed!\n");

  // });

  browser.close();
  console.log(page.url());
  //   window.destroy();
};

main();
